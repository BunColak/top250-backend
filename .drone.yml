kind: pipeline
name: default

steps:
- name: deploy
  image: docker:dind
  volumes:
  - name: dockersock
    path: /var/run
  commands:
  - sleep 5
  - docker build . -t top250
  - docker run -p 9001:4000 -p 9002:4000 --restart=unless-stopped -d top250 
  environment:
    DATABASE_URL: 
      from_secret: database_url 


services:
- name: docker
  image: docker:dind
  volumes:
  - name: dockersock
    path: /var/run

volumes:
- name: dockersock
  temp: {}